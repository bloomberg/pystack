<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Changelog" href="../changelog.html" /><link rel="prev" title="Prime Number Generation" href="random_prime_number.html" />
        <link rel="prefetch" href="../_static/logo.png" as="image" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.1.3 and Furo 2025.07.19 -->
        <title>Debugging Core Files - pystack</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../overview.html"><div class="brand">pystack</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../overview.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/logo.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../process.html">Analyzing processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../corefile.html">Analyzing core dumps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../customizing_the_reports.html">Customizing the reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hands-on Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deadlock.html">Deadlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="random_prime_number.html">Prime Number Generation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Debugging Core Files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorials/core_tutorial.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="debugging-core-files">
<h1>Debugging Core Files<a class="headerlink" href="#debugging-core-files" title="Link to this heading">¶</a></h1>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Link to this heading">¶</a></h2>
<p>This lesson is meant to familiarize you with using the <code class="docutils literal notranslate"><span class="pre">pystack</span> <span class="pre">core</span></code> subcommand to analyze a core
dump file. The steps will help you enable core dumps in your Linux environment, run a script that
crashes and leaves a core dump, and then analyze the core dump file with PyStack.</p>
</section>
<section id="ensuring-core-dumps-are-enabled">
<h2>Ensuring core dumps are enabled<a class="headerlink" href="#ensuring-core-dumps-are-enabled" title="Link to this heading">¶</a></h2>
<p>First, we need to ensure that crashing processes in our Linux environment leave core files behind.</p>
<p>The system allows setting a limit on the size of a core dump, to avoid filling up your disk when
a process is crashing frequently. You can check the configured size limit by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">ulimit</span><span class="w"> </span>-c
</pre></div>
</div>
<p>If that reports <code class="docutils literal notranslate"><span class="pre">0</span></code> it means that core files have been disabled on your machine, and you’ll need
to enable them before proceeding with this tutorial. You can enable them using the <code class="docutils literal notranslate"><span class="pre">ulimit</span></code>
command in your terminal:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># unlimited core size</span>
<span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span>unlimited

<span class="c1"># or if you want to limit the size to 100 MB instead</span>
<span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span><span class="m">100000</span>
</pre></div>
</div>
<p>Note that this command only enables core files for the shell session you ran the command in. If you
want to make this change permanent, you can add that line to your <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> or <code class="docutils literal notranslate"><span class="pre">~/.zshrc</span></code> file
depending on your terminal preference. For instance:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;ulimit -c unlimited&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
</pre></div>
</div>
<p>Next, we want to check where core dump files will be written. Check what this command prints:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/proc/sys/kernel/core_pattern
</pre></div>
</div>
<p>That may contain placeholders, prefixed with <code class="docutils literal notranslate"><span class="pre">%</span></code>. You can learn more about what placeholders are
available in the “Naming of core dump files” section of <a class="reference external" href="https://man7.org/linux/man-pages/man5/core.5.html">man 5 core</a>.</p>
<p>If you want to control the names used for generated core files, you can update the <code class="docutils literal notranslate"><span class="pre">core_pattern</span></code>
setting with <code class="docutils literal notranslate"><span class="pre">sysctl</span></code>. Note that this affects all users and processes on the machine! The naming
of core dump files can be configured like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>kernel.core_pattern<span class="o">=</span><span class="s2">&quot;/tmp/core-%e.%p.%h.%t&quot;</span>
</pre></div>
</div>
<p>In this example, we configure the file pattern to include the executable name (<code class="docutils literal notranslate"><span class="pre">%e</span></code>), process ID
(<code class="docutils literal notranslate"><span class="pre">%p</span></code>), hostname (<code class="docutils literal notranslate"><span class="pre">%h</span></code>), and timestamp (<code class="docutils literal notranslate"><span class="pre">%t</span></code>), and to be written to the <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> directory. If
you would like to learn more about core dumps, Red Hat has more information <a class="reference external" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/developer_guide/debugging-crashed-application#debugging-crashed-application_understanding-core-dumps6">here</a>.</p>
</section>
<section id="generating-the-core-dump">
<h2>Generating the Core Dump<a class="headerlink" href="#generating-the-core-dump" title="Link to this heading">¶</a></h2>
<p>You can test whether core dumps are being generated by running this command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import os; os.abort()&#39;</span>
</pre></div>
</div>
<p>If everything is configured properly, you should see a message telling you that the process aborted
and a core file was dumped. If your shell is bash, that might say simply <code class="docutils literal notranslate"><span class="pre">Aborted</span> <span class="pre">(core</span> <span class="pre">dumped)</span></code>.
If you use zsh, you’d see something like <code class="docutils literal notranslate"><span class="pre">zsh:</span> <span class="pre">abort</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">python3</span> <span class="pre">-c</span> <span class="pre">'import</span> <span class="pre">os;</span> <span class="pre">os.abort()'</span></code>.</p>
<p>Now, we need to find the core file. Given the <code class="docutils literal notranslate"><span class="pre">core_pattern</span></code> that we configured above with
<code class="docutils literal notranslate"><span class="pre">sysctl</span></code>, the core dump should have been written to <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> and its name should start with
<code class="docutils literal notranslate"><span class="pre">core-</span></code>, so you can find the core file with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>/tmp/core-*
</pre></div>
</div>
</section>
<section id="analyzing-the-core-dump">
<h2>Analyzing the Core Dump<a class="headerlink" href="#analyzing-the-core-dump" title="Link to this heading">¶</a></h2>
<p>Now that we have generated the core dump file and located it on disk, we can use the <code class="docutils literal notranslate"><span class="pre">pystack</span>
<span class="pre">core</span></code> command to analyze it like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pystack<span class="w"> </span>core<span class="w"> </span>/tmp/core-&lt;executable_name&gt;.&lt;process_id&gt;.&lt;hostname&gt;.&lt;timestamp&gt;
</pre></div>
</div>
<p>The output will display the stack trace of the core dump file, which will help you identify the
source of the error. In the case of explicitly telling the process to abort itself, that stack isn’t
all that interesting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">executable</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">core</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">src</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span>

<span class="n">Core</span> <span class="n">file</span> <span class="n">information</span><span class="p">:</span>
<span class="n">state</span><span class="p">:</span> <span class="n">R</span> <span class="n">zombie</span><span class="p">:</span> <span class="kc">True</span> <span class="n">niceness</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">pid</span><span class="p">:</span> <span class="mi">618</span> <span class="n">ppid</span><span class="p">:</span> <span class="mi">473</span> <span class="n">sid</span><span class="p">:</span> <span class="mi">473</span>
<span class="n">uid</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">gid</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">pgrp</span><span class="p">:</span> <span class="mi">618</span>
<span class="n">executable</span><span class="p">:</span> <span class="n">python3</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

<span class="n">The</span> <span class="n">process</span> <span class="n">died</span> <span class="n">due</span> <span class="n">receiving</span> <span class="n">signal</span> <span class="n">SIGABRT</span>
<span class="n">Traceback</span> <span class="k">for</span> <span class="n">thread</span> <span class="mi">618</span> <span class="p">[</span><span class="n">Has</span> <span class="n">the</span> <span class="n">GIL</span><span class="p">]</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="p">(</span><span class="n">Python</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>By default PyStack shows you the same Python stack as the interpreter would print if an exception
occurred. Since the Python stack only has one frame on it, there’s not much to see here! For
debugging a crash, though, it’s generally best to use the <code class="docutils literal notranslate"><span class="pre">--native</span></code> flag to display the
interpreter’s native C frames, as well as any C or C++ or Rust frames from libraries you are using,
interleaved with the Python frames in the resulting stack trace.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pystack<span class="w"> </span>core<span class="w"> </span>--native<span class="w"> </span>/tmp/core-&lt;executable_name&gt;.&lt;process_id&gt;.&lt;hostname&gt;.&lt;timestamp&gt;
</pre></div>
</div>
<p>This will produce output similar to the below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">executable</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">core</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">src</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span>

<span class="n">Core</span> <span class="n">file</span> <span class="n">information</span><span class="p">:</span>
<span class="n">state</span><span class="p">:</span> <span class="n">R</span> <span class="n">zombie</span><span class="p">:</span> <span class="kc">True</span> <span class="n">niceness</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">pid</span><span class="p">:</span> <span class="mi">618</span> <span class="n">ppid</span><span class="p">:</span> <span class="mi">473</span> <span class="n">sid</span><span class="p">:</span> <span class="mi">473</span>
<span class="n">uid</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">gid</span><span class="p">:</span> <span class="mi">1000</span> <span class="n">pgrp</span><span class="p">:</span> <span class="mi">618</span>
<span class="n">executable</span><span class="p">:</span> <span class="n">python3</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="p">;</span> <span class="n">os</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

<span class="n">The</span> <span class="n">process</span> <span class="n">died</span> <span class="n">due</span> <span class="n">receiving</span> <span class="n">signal</span> <span class="n">SIGABRT</span>
<span class="n">Traceback</span> <span class="k">for</span> <span class="n">thread</span> <span class="mi">618</span> <span class="p">[</span><span class="n">Has</span> <span class="n">the</span> <span class="n">GIL</span><span class="p">]</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">0</span><span class="p">,</span> <span class="ow">in</span> <span class="n">_start</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;../csu/libc-start.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">360</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__libc_start_main</span><span class="o">@</span><span class="nd">@GLIBC_2</span><span class="mf">.34</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;../sysdeps/nptl/libc_start_call_main.h&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">58</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__libc_start_call_main</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">0</span><span class="p">,</span> <span class="ow">in</span> <span class="n">Py_BytesMain</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">0</span><span class="p">,</span> <span class="ow">in</span> <span class="n">Py_RunMain</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">0</span><span class="p">,</span> <span class="ow">in</span> <span class="n">PyRun_SimpleStringFlags</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;???&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">0</span><span class="p">,</span> <span class="ow">in</span> <span class="n">PyRun_StringFlags</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Python</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;./stdlib/abort.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">79</span><span class="p">,</span> <span class="ow">in</span> <span class="n">abort</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;../sysdeps/posix/raise.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="k">raise</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;./nptl/pthread_kill.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">89</span><span class="p">,</span> <span class="ow">in</span> <span class="n">pthread_kill</span><span class="o">@</span><span class="nd">@GLIBC_2</span><span class="mf">.34</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;./nptl/pthread_kill.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">78</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__pthread_kill_internal</span> <span class="p">(</span><span class="n">inlined</span><span class="p">)</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
    <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">File</span> <span class="s2">&quot;./nptl/pthread_kill.c&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">44</span><span class="p">,</span> <span class="ow">in</span> <span class="n">__pthread_kill_implementation</span> <span class="p">(</span><span class="n">inlined</span><span class="p">)</span> <span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">so</span><span class="mf">.6</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this now includes not only the Python frames on the stack, but also the C frames that
led to the first Python call on the stack, as well as the C frames that the last Python call on the
stack called into. This lets us see how the interpreter implements the <code class="docutils literal notranslate"><span class="pre">os.abort()</span></code> function, as
well as how the C library (glibc) implements its own <code class="docutils literal notranslate"><span class="pre">abort()</span></code> function!</p>
</section>
<section id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">¶</a></h2>
<p>Read through the code in <code class="docutils literal notranslate"><span class="pre">core_tutorial.py</span></code> and see if you can spot any bugs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span><span class="w"> </span><span class="nf">types_found_in_tuples</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="n">elem_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_objects</span><span class="p">():</span>
<span class="linenos"> 8</span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="linenos"> 9</span>            <span class="n">elem_types</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="k">for</span> <span class="n">elem_type</span> <span class="ow">in</span> <span class="n">elem_types</span><span class="p">:</span>
<span class="linenos">12</span>        <span class="k">yield</span> <span class="n">elem_type</span>
<span class="linenos">13</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># printing all results with multiple calls to print</span>
<span class="linenos">16</span><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types_found_in_tuples</span><span class="p">():</span>
<span class="linenos">17</span>    <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="c1"># printing all results with one call to print</span>
<span class="linenos">20</span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">types_found_in_tuples</span><span class="p">(),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Given the context of this exercise, you won’t be particularly surprised to learn that this code
crashes, and leaves a core file for you to investigate. Spend a few minutes investigating the
<code class="docutils literal notranslate"><span class="pre">pystack</span> <span class="pre">core</span> <span class="pre">--native</span></code> report for the core file generated by running this script, and see if you
can figure out what’s going wrong. If you aren’t familiar with Python’s internals this will be
tough, but these hints should help:</p>
<details>
<summary><i>Hint 1</i></summary><p>This program uses <a class="reference external" href="https://docs.python.org/3/library/gc.html#gc.get_objects" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gc.get_objects</span></code></a> to find every tuple in the program’s memory, and then finds the
set of distinct element types contained in tuples. The <code class="docutils literal notranslate"><span class="pre">for</span></code> loop on lines 16 and 17 runs
successfully to completion and produces a usable report. We know that it finishes because the
PyStack report shows that the crash happens inside the call on line 20.</p>
<p>Printing each type one at a time in a loop ought to be equivalent to telling <code class="docutils literal notranslate"><span class="pre">print()</span></code> to print
them all at once with newlines between each. Why isn’t it?</p>
</details>
<details>
<summary><i>Hint 2</i></summary><p>Check the local variables with <code class="docutils literal notranslate"><span class="pre">--locals</span></code> as well. Can you spot anything wrong there?</p>
</details>
<details>
<summary><i>Hint 3</i></summary><p><code class="docutils literal notranslate"><span class="pre">--native</span></code> mode shows us that the crash happens within a call to <a class="reference external" href="https://docs.python.org/3/c-api/sequence.html#c.PySequence_Tuple" title="(in Python v3.13)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_Tuple()</span></code></a>. Read
up on what that function does, and see if that gives you a clue about what’s going wrong here.</p>
</details>
<details>
<summary><i>Hint 4</i></summary><p>The documentation tells us that <a class="reference external" href="https://docs.python.org/3/c-api/sequence.html#c.PySequence_Tuple" title="(in Python v3.13)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_Tuple()</span></code></a> can be called on either a sequence or an
iterable. Can you tell from the stack what type of object it was being called on when the crash
happened?</p>
</details>
<details>
<summary><i>Hint 5</i></summary><p>What gets printed out if you run this Python code?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">args_type</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

<span class="n">args_type</span><span class="p">()</span>
</pre></div>
</div>
</details></section>
<section id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Link to this heading">¶</a></h2>
<details>
<summary><i>Toggle to see the explanation</i></summary><p>Just by using <code class="docutils literal notranslate"><span class="pre">--native</span></code> mode, we see some interesting things. First, the crash doesn’t happen
when we loop over the values yielded by <code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code> with a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, but does
happen when we pass all the yielded values to <code class="docutils literal notranslate"><span class="pre">print</span></code> using <code class="docutils literal notranslate"><span class="pre">*</span></code> for unpacking. Second, the crash
happens inside of a call to <a class="reference external" href="https://docs.python.org/3/c-api/sequence.html#c.PySequence_Tuple" title="(in Python v3.13)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_Tuple()</span></code></a>, which is the C function equivalent to the
Python code <code class="docutils literal notranslate"><span class="pre">tuple(iterable)</span></code>.</p>
<p>When we add <code class="docutils literal notranslate"><span class="pre">--locals</span></code> into the mix, we additionally see the very surprising value of <code class="docutils literal notranslate"><span class="pre">obj</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>obj: (&lt;invalid object at 0x0&gt;, &lt;invalid object at 0x0&gt;, ...)
</pre></div>
</div>
<p>That’s PyStack’s representation of a tuple whose first two elements are <a class="reference external" href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare/">NULL pointers</a>!</p>
<p>This is about as much as PyStack can tell us, and from here we need to figure things out on our own.
But all the clues are there:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code> was called into by <a class="reference external" href="https://docs.python.org/3/c-api/sequence.html#c.PySequence_Tuple" title="(in Python v3.13)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PySequence_Tuple()</span></code></a>, which constructs a new
tuple from an iterable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code> went on to discover a tuple that contains NULL pointers</p></li>
<li><p>The problem only happens when we use <code class="docutils literal notranslate"><span class="pre">*</span></code> unpacking in the call to <code class="docutils literal notranslate"><span class="pre">print</span></code>, and doesn’t happen
when we use a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop</p></li>
<li><p>Functions receive <code class="docutils literal notranslate"><span class="pre">*args</span></code> as a tuple!</p></li>
</ol>
<p>What’s happening here is that, in order to execute <code class="docutils literal notranslate"><span class="pre">print(*types_found_in_tuples())</span></code>, the
interpreter needs to create a new tuple to pass to <code class="docutils literal notranslate"><span class="pre">print</span></code>, which will contain all of the values
yielded by <code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code>. The interpreter creates that tuple, and then starts
iterating over the generator produced by calling <code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code> in order to populate
that new tuple and get it ready to pass to <code class="docutils literal notranslate"><span class="pre">print</span></code>. But <code class="docutils literal notranslate"><span class="pre">types_found_in_tuples()</span></code> uses
<a class="reference external" href="https://docs.python.org/3/library/gc.html#gc.get_objects" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gc.get_objects</span></code></a> and discovers this new, partially initialized tuple, and chaos ensues when it tries
to use that object before the interpreter has finished assigning its elements.</p>
</details></section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h2>
<p>In this tutorial, we learned how to use the <code class="docutils literal notranslate"><span class="pre">core</span></code> subcommand to get stack traces from core dumps.
We learned how to ensure core files are produced, and how to test that. We then analyzed the core
dump file using the <code class="docutils literal notranslate"><span class="pre">pystack</span></code> command to identify the source of the fault. Using the <code class="docutils literal notranslate"><span class="pre">--native</span></code>
flag, we were able to view what the Python interpreter itself was doing at the time of the crash,
which provided further insights into the cause of the error. By understanding how to analyze core
dump files, we can effectively debug and troubleshoot interpreter crashes.</p>
<p>Thank you for following along with this tutorial. Happy coding!</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../changelog.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="random_prime_number.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Prime Number Generation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Debugging Core Files</a><ul>
<li><a class="reference internal" href="#intro">Intro</a></li>
<li><a class="reference internal" href="#ensuring-core-dumps-are-enabled">Ensuring core dumps are enabled</a></li>
<li><a class="reference internal" href="#generating-the-core-dump">Generating the Core Dump</a></li>
<li><a class="reference internal" href="#analyzing-the-core-dump">Analyzing the Core Dump</a></li>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
<li><a class="reference internal" href="#solution">Solution</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    </body>
</html>